---
import X from "@tabler/icons/outline/x.svg";
import type { HTMLAttributes } from "astro/types";
import { tv } from "tailwind-variants";

type Props = HTMLAttributes<"dialog"> & {
  /**
   * Side of the page the sheet opens from
   */
  side?: "top" | "right" | "bottom" | "left";
  /**
   * Open and close animation duration in milliseconds
   */
  animationDuration?: number;
};

const { side = "right", class: className, animationDuration = 300, ...rest } = Astro.props;

export const dialogBackdrop = tv({
  base: [
    "starwind-dialog-backdrop fixed inset-0 top-0 left-0 z-50 hidden h-screen w-screen bg-black/80",
    "data-[state=open]:animate-in fade-in",
    "data-[state=closed]:animate-out data-[state=closed]:fill-mode-forwards fade-out",
    // "data-[state=closed]:duration-300 data-[state=open]:duration-500",
  ],
});

export const sheetContent = tv({
  base: [
    "starwind-dialog-content",
    "bg-background fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out",
    "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fill-mode-forwards",
    // "data-[state=closed]:duration-300 data-[state=open]:duration-500",
  ],
  variants: {
    side: {
      right: [
        "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right",
        "inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
      ],
      left: [
        "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left",
        "inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
      ],
      top: [
        "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        "inset-x-0 top-0 h-auto border-b",
      ],
      bottom: [
        "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        "inset-x-0 bottom-0 h-auto border-t",
      ],
    },
  },
  defaultVariants: {
    side: "right",
  },
});

export const sheetCloseButton = tv({
  base: [
    "starwind-dialog-close",
    "ring-offset-background focus:ring-ring data-[state=open]:bg-secondary",
    "absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100",
    "focus-visible:outline-outline focus-visible:outline-2 focus-visible:outline-offset-2",
    "disabled:pointer-events-none",
  ],
});
---

<!-- dialog overlay -->
<div
  class={dialogBackdrop()}
  data-state="closed"
  data-slot="dialog-backdrop"
  style={{ animationDuration: `${animationDuration}ms` }}
>
</div>

<dialog
  class={sheetContent({ side, class: className })}
  data-state="closed"
  data-slot="sheet-content"
  {...rest}
  style={{ animationDuration: `${animationDuration}ms` }}
>
  <slot />
  <button
    type="button"
    class={sheetCloseButton()}
    data-slot="sheet-close"
    aria-label="Close dialog"
  >
    <X class="size-5" />
    <span class="sr-only">Close</span>
  </button>
</dialog>
